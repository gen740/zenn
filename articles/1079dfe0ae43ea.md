---
title: "Vim ã®ç§»å‹•æ“ä½œãŒã‚ã‹ã‚Šã‚„ã™ãã—ãŸè©±"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vim", "neovim"]
published: true
---

# Smooth cursor

## ä½œã£ãŸã‚‚ã®
![](/images/smoothcursor/Smooth_cursor.gif)

## ä½œã£ãŸç†ç”±
ã€€vimã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹æ™‚ã€`gg` ã‚„ `G`ã€`<C-u>`ã€`<C-d>` ã§ã‚ˆãã‚«ãƒ¼ã‚½ãƒ«ã‚’è¦‹å¤±ãªã£ã¦ã—ã¾ã„ã€ã¾ãŸãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ–¹å‘ã‚‚ã¯ã£ãã‚Šã¨ã—ã¾ã›ã‚“ã€‚
ã€€ã‚‚ã¡ã‚ã‚“ã€ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã‚ˆã†ã«ä½œã‚‰ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å­˜åœ¨ã—ã€ `cursorline` ã‚’æœ‰åŠ¹ã«ã—ãŸã‚Š `smooth scroll` ãªã©ã¨è¨€ã£ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚
ã€€ã—ã‹ã—ã€ç§ã«ã¯ã©ã¡ã‚‰ã‚‚ã‚ã¾ã‚Šå¥½ã¿ã®å‹•ãæ–¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã€€ãã“ã§ã€è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã„å‰¯ã‚«ãƒ¼ã‚½ãƒ«ã‚’ä½œã‚Šã‚«ãƒ¼ã‚½ãƒ«ã‚’è¿½å¾“ã•ã›ã‚‹ã‚ˆã†ã«æç”»ã•ã›ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## Code
ã€€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã®å…¨æ–‡ã§ã™ã€‚ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€å…¨ã¦ `lua` ã§æ›¸ã„ã¦ã„ã¾ã™ã€‚
```lua
local uv = vim.loop
local cursor_timer = uv.new_timer()

vim.cmd.sign("define smoothcursor text=ï‘Š")

local function smoothcursor()
    -- å‰ã®ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ãŒå­˜åœ¨ã—ãªã„ãªã‚‰ã€ç¾åœ¨ã®ä½ç½®ã«ã™ã‚‹
    if vim.b.cursor_row_prev == nil then
        vim.b.cursor_row_prev = vim.fn.getcurpos(vim.fn.win_getid())[2]
    end
    vim.b.cursor_row_now = vim.fn.getcurpos(vim.fn.win_getid())[2]
    vim.b.diff = vim.b.cursor_row_prev - vim.b.cursor_row_now
    if math.abs(vim.b.diff) > 3 then -- ãŸãã•ã‚“ã‚¸ãƒ£ãƒ³ãƒ—ã—ãŸã‚‰
        -- å‹•ã„ã¦ã„ã‚‹ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°ã‚¹ãƒˆãƒƒãƒ—ã™ã‚‹
        cursor_timer:stop()
        local counter = 1
        -- ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹
        uv.timer_start(cursor_timer, 0, 35, vim.schedule_wrap(
            function()
                vim.b.cursor_row_now = vim.fn.getcurpos(vim.fn.win_getid())[2]
                vim.b.diff = vim.b.cursor_row_prev - vim.b.cursor_row_now
                vim.b.cursor_row_prev = vim.b.cursor_row_prev -
                    ((vim.b.diff > 0) and math.ceil(vim.b.diff / 4) or math.floor(vim.b.diff / 4))
                vim.cmd.sign(string.format("unplace 31415 file=%s", vim.fn.expand("%:p")))
                vim.cmd.sign(string.format("place 31415 line=%d name=smoothcursor file=%s",
                    vim.b.cursor_row_prev, vim.fn.expand("%:p")))
                counter = counter + 1
                if counter > 200 or vim.b.diff == 0 then
                    cursor_timer:stop()
                end
            end)
        )
    else
        vim.b.cursor_row_prev = vim.b.cursor_row_now
        vim.cmd(string.format("silent! sign unplace 31415 file=%s", vim.fn.expand("%:p")))
        vim.cmd(string.format("silent! sign place 31415 line=%d name=smoothcursor file=%s",
            vim.b.cursor_row_now, vim.fn.expand("%:p")))
    end
end
```
ã€€ã‚³ãƒ¼ãƒ‰ã¯å®Ÿã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã‚ã‚‹ç¨‹åº¦ã¾ã¨ã¾ã£ã¦ç§»å‹•ã—ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã—ã€ sign ã«æç”»ã—ãŸã‚«ãƒ¼ã‚½ãƒ«ã‚’ç§»å‹•ã•ã›ã‚‹ã ã‘ã§ã™ã€‚
ã€€ä¸Šã®ã‚³ãƒ¼ãƒ‰ä¸­ã«ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’èª¿ç¯€ã™ã‚Œã°ã€è¿½å°¾ã™ã‚‹é€Ÿåº¦ã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
