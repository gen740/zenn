---
title: "clasp ã§ GAS ã‚’æ›¸ã"
emoji: "ğŸ’ª"
type: "tech"
topics: ["typescript", "GAS", "javascript", "clasp"]
published: true
---

# å‹•æ©Ÿ

è‡ªåˆ†ã®å¥½ããªã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã€GAS ã‚’ web ä¸Šã§æ›¸ãã®ã¯ã¨ã¦ã‚‚ã‚¹ãƒˆãƒ¬ã‚¹ãŒæºœã¾ã‚‹ã€‚GAS ã¯ javascript ãƒ™ãƒ¼ã‚¹ãªã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§è£œå®Œå³¶ã‚’ä½¿ã£ã¦æ›¸ããŸã„ã€‚ã•ã‚‰ã«è¨€ãˆã° typescript ã§æ›¸ããŸã„ã€‚
ã¨ã„ã†ã‚ã‘ã§å‚™å¿˜éŒ²ã‚‚å…¼ã­ã¦ã€æ‰‹é †æ›¸ã‚’ä½œæˆã™ã‚‹

[https://github.com/gen740/TypescriptGASTemplate](https://github.com/gen740/TypescriptGASTemplate)

# clasp ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

## clasp ã¨ã¯

[clasp](https://github.com/google/clasp) ã¨ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ GAS ã‚’æ›¸ããã‚Œã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€‚ç°¡å˜ã«å§‹ã‚ã‚‹ã«ã¯ã€[aside](https://github.com/google/aside) ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šï¼ˆä¸­ã§ã¯ clasp ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼‰ãã‚Œã§ä½œæˆã—ã¦ã‹ã‚‰è‰²ã€…ã„ã˜ã‚‹ã¨ç°¡å˜ã«ã§ãã‚‹ãŒã€ã“ã“ã§ã¯ clasp ã ã‘ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

# node & clasp ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. ãŠå¥½ããªãƒ„ãƒ¼ãƒ«ã§ `nodojs` ã‚’å…¥ã‚Œã€ `npm install -g clasp` ã§ `clasp` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
1. `clasp login` ã§ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã™ã‚‹ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

1. `clasp create project_name` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆãŒã§ãã‚‹ã€‚
1. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«èã‹ã‚Œã‚‹ã®ã§å¥½ããªã®ã‚’é¸ã¶ã€å¾Œã‹ã‚‰ã§ã‚‚è‰²ã€…ã„ã˜ã£ã¦å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚ã“ã“ã§ã¯ `standalone` ã‚’é¸ã¶ 
1. ãã†ã™ã‚‹ã¨ `appsscript.json` ãŒã§ãã‚‹ã€‚ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã‚‹ã¯ãšã€‚

```python
{
  "timeZone": "America/New_York",
  "dependencies": {
  },
  "exceptionLogging": "STACKDRIVER",
  "runtimeVersion": "V8"
}
```

## [Typescript ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](https://github.com/google/clasp/blob/master/docs/typescript.md)

1. typescript ã®å‹å®šç¾©ã‚’å…¥ã‚Œã‚‹ã€‚(clasp â‰¥ 1.5.0 ã˜ã‚ƒãªã„ã¨ typescript ã¯ä½¿ç”¨ã§ããªã„ï¼‰
    1. `npm i -D @types/google-apps-script` 
1. `tsconfig.json` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã

    ```json
    {
      "compilerOptions": {
        "lib": ["esnext"],
        "experimentalDecorators": true
      }
    }
    ```
1. `hello.ts` ã‚’æ›¸ã

    ```typescript
    const greeter = (person: string) => {
      return `Hello, ${person}!`;
    }

    function testGreeter() {
      const user = 'Grant';
      Logger.log(greeter(user));
    }
    ```
1. `clasp push` ã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
    1. `clasp` ã¯ typescript ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨è‡ªå‹•ã§ `.gs` ã«ã¨ã‚‰ã‚“ã‚¹ãƒ‘ã‚¤ã‚¹ã—ã¦ãã‚Œã‚‹ã®ã§ã€å¤‰æ›´ãªã©ã¯å¿…è¦ãªã„
    1. **æ³¨æ„ï¼ ****`.claspignore`**** ã« ****`node_modules`**** ãªã©ã‚’å…¥ã‚Œã¦ãŠã‹ãªã„ã¨ã€ ****`node_modules`**** ã®ä¸­ã®ã‚³ãƒ¼ãƒ‰ã¨ã‹ã¾ã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã—ã¾ã†ã€‚ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã« ****`.claspignore`**** ã‚’æ›¸ã**

    ```plain text
    **/.git/**
    **/node_modules/**

    .clasp.json
    .claspignore
    package-lock.json
    package.json
    tsconfig.json
    ```

# npm ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã‹ã€ ES module ã‚’ä½¿ã„ãŸã„

clasp ã¯ ES module ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ä¸Šã«ã€npm ãªã©ã«å¯¾å¿œã‚’ã—ã¦ã„ã¾ã›ã‚“ã€‚GAS ã¨ã„ã†ã©ã†è¶³æ»ã„ã¦ã‚‚ä½¿ãˆãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å­˜åœ¨ã—ã¾ã™ã€‚ã—ã‹ã—ã€ãã®ä¸Šã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ä½¿ã†ã«ã¯ä¸€åº¦ã‚·ãƒ³ã‚°ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã« third-party ã® `webpack` ç­‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã§å¤‰æ›ã—ã¦ push ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
ä½¿ç”¨ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã¯è‰²ã€…ã‚ã‚‹ãŒã“ã“ã§ã¯ `webpack` ã‚’ç”¨ã„ã‚‹

## webpack ã‚’ä½¿ã†

webpack ã¨ã¯

>Webpackã¯ã€JavaScriptã‚’ä¸­å¿ƒã¨ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ©ã§ã€è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚¢ã‚»ãƒƒãƒˆï¼ˆCSSã€ç”»åƒãªã©ï¼‰ã‚’ä¾å­˜é–¢ä¿‚ã«åŸºã¥ãåŠ¹ç‡çš„ã«ã¾ã¨ã‚ã€æœ€é©åŒ–ã—ã¦1ã¤ã¾ãŸã¯è¤‡æ•°ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰åˆ†å‰²ã€ãƒ„ãƒªãƒ¼ã‚·ã‚§ã‚¤ã‚­ãƒ³ã‚°ã€ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚ˆã‚‹æ‹¡å¼µãŒå¯èƒ½ã§ã€ãƒ¢ãƒ€ãƒ³ãªWebã‚¢ãƒ—ãƒªé–‹ç™ºã‚’æ”¯æ´ã—ã¾ã™ã€‚ (ChatGPT)



1. `npm install webpack webpack-cli typescript ts-loader --save-dev` ã§ webpack ã¨ typescript ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
1. `tsconfig.json` ã‚’è¨˜è¿°

    ```typescript
    {
      "compilerOptions": {
        "lib": ["esnext"],
        "experimentalDecorators": true,
        "outDir": "./dist/",
        "noImplicitAny": true,
        "module": "es6",
        "target": "es5",
        "allowJs": true,
        "moduleResolution": "node"
      }
    }
    ```
1. `src/main.ts` ã®ã‚’ä½œæˆã™ã‚‹

    ```typescript
    function hello() {
      Logger.log("Hello, world!");
    }
    ```
1. `webpack.config.mjs` ã‚’ä½œæˆ ( common js ã‚’ä½¿ã„ãŸã„å ´åˆã¯ `.js` ã‚’ä½¿ç”¨ã™ã‚‹ )

    ```javascript
    import path from "node:path";
    import { fileURLToPath } from "node:url";

    export default {
      mode: "production",
      module: {
        rules: [
          {
            test: /\.tsx?$/,
            use: "ts-loader",
            exclude: /node_modules/,
          },
        ],
      },
      entry: "./src/main.ts",
      output: {
        filename: "main.js",
        path: path.resolve(path.dirname(fileURLToPath(import.meta.url)), "dist"),
      },
      experiments: {
        outputModule: true, // ECMAScript ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’å‰Šæ¸›
      },
      optimization: {
        minimize: false,
      },
    };
    ```
1. `.claspignore` ã« `**/src/**`ã€ `webpack.config.json` ã‚’è¿½åŠ 
1. `package.json` ã«ä»¥ä¸‹ã‚’è¿½åŠ 

    ```typescript
    "scripts": {
      "build": "webpack --config webpack.config.mjs",
      "push": "clasp push",
      "deploy": "npm run build && npm run push"
    }
    ```
1. ã“ã‚Œã§ `npm run deploy` ã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ« & ãƒ‡ãƒ—ãƒ­ã‚¤ãŒã§ãã‚‹